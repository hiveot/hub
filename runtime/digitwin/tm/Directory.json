{
  "@context": [
    "https://www.w3.org/2022/wot/td/v1.1",
    "https://www.w3.org/2022/wot/discovery",
    {
      "hiveot": "https://www.hiveot.net/vocab/v0.1"
    }
  ],
  "@type": [
    "tm:ThingModel",
    "ThingDirectory"
  ],
  "id": "ThingDirectory",
  "title": "DigiTwin Directory Service",
  "description": "HiveOT digital twin directory service",
  "version": {
    "instance": "0.1.0"
  },
  "created": "2025-09-22T17:00:00.000Z",
  "modified": "2025-09-22T17:00:00.000Z",
  "support": "https://www.github.com/hiveot/hub",
  "base": "{{DIRECTORY_BASE_URL}}",
  "deny": [
    "none"
  ],
  "properties": {
    "things": {
      "description": "Retrieve all Thing Descriptions",
      "comment": "Define for spec compatibility. An action (retrieveAllThings) should be used instead.",
      "type": "array",
      "items": {
        "description": "Thing Description",
        "type": "object"
      },
      "uriVariables": {
        "offset": {
          "title": "Number of TDs to skip before the page",
          "type": "number",
          "default": 0
        },
        "limit": {
          "title": "Number of TDs in a page",
          "type": "number",
          "default": 1
        }
      },
      "forms": [
        {
          "href": "/things{?offset,limit}",
          "htv:methodName": "GET",
          "response": {
            "description": "Success response",
            "htv:statusCodeValue": 200,
            "contentType": "application/ld+json",
            "htv:headers": [
              {
                "htv:fieldName": "Link"
              }
            ]
          },
          "additionalResponses": [
            {
              "description": "Invalid query arguments",
              "contentType": "application/problem+json",
              "htv:statusCodeValue": 400
            }
          ]
        }
      ]
    }
  },

  "events": {
    "thingUpdated": {
      "title": "Thing Updated",
      "description": "A digital twin Thing TD was updated in the directory",
      "data": {
        "title": "TD",
        "description": "JSON encoded TD of the digital twin Thing",
        "type": "string"
      }
    },
    "thingDeleted": {
      "title": "Thing Deleted",
      "description": "A Thing TD was removed from the directory",
      "data": {
        "title": "Thing ID",
        "description": "ID of the digital twin Thing that was deleted",
        "type": "string"
      }
    }
  },

  "actions": {
    "createThing": {
      "@type": "hiveot:function",
      "title": "Create Thing TD",
      "description": "Update the Thing TD in the directory. For use by agents only.",
      "idempotent": true,
      "allow": [
        "agent",
        "admin"
      ],
      "comment": "Only agents can update their TD",
      "input": {
        "title": "TD JSON",
        "description": "Device TD document in JSON format",
        "comment": "The spec defines type object but there is no scheme associated with it.",
        "type": "string"
      },
      "uriVariables": {
        "id": {
          "type": "string",
          "comment": "uri 'id' is in the spec, this is ignored as the TD contains the ID."
        }
      },
      "forms": [
        {
          "href": "/things/{id}",
          "htv:methodName": "PUT",
          "response": {
            "description": "Success response",
            "htv:statusCodeValue": 201
          },
          "additionalResponses": [
            {
              "description": "Invalid serialization or TD",
              "contentType": "application/problem+json",
              "htv:statusCodeValue": 400
            }
          ]
        }
      ]
    },

    "deleteThing": {
      "@type": "hiveot:function",
      "title": "Delete Thing",
      "description": "Remove a digital twin TD from the directory",
      "safe": false,
      "idempotent": true,
      "allow": [
        "admin"
      ],
      "comment": "only admin can remove TDs",
      "input": {
        "title": "dThing ID",
        "type": "string"
      },
      "uriVariables": {
        "id": {
          "type": "string",
          "comment": "uri 'id' maps to input.",
          "hiveot:input": ""
        }
      },
      "forms": [
        {
          "href": "/things/{id}",
          "htv:methodName": "DELETE",
          "response": {
            "description": "Success response",
            "htv:statusCodeValue": 204
          },
          "additionalResponses": [
            {
              "description": "TD with the given id not found",
              "contentType": "application/problem+json",
              "htv:statusCodeValue": 404
            }
          ]
        }
      ]
    },

    "retrieveThing": {
      "@type": "hiveot:function",
      "title": "Retrieve a TD",
      "description": "Return a JSON encoded TD document",
      "safe": true,
      "idempotent": true,
      "uriVariables": {
        "id": {
          "title": "Thing Description ID",
          "type": "string",
          "comment": "uri 'id' maps to input.",
          "hiveot:input": ""
        }
      },
      "input": {
        "title": "Thing ID",
        "type": "string",
        "description": "Digital-Twin Thing ID of the Thing to read",
        "comment": "URI variables can be used as input where supported"
      },
      "output": {
        "title": "TD",
        "description": "A JSON encoded Thing Description Document",
        "type": "string"
      },
      "forms": [
        {
          "href": "/things/{id}",
          "htv:methodName": "GET",
          "comments": [
            "Additional http endpoint as per spec to read a TD.",
            "Use URI variable as second method of input",
            "The alternative endpoint is /things/invokeaction/retrieveThing with payload the thingID"
          ]
        }
      ]
    },

    "retrieveAllThings": {
      "@type": "hiveot:function",
      "title": "Read all TDs",
      "description": "Read a batch of TD documents",
      "safe": true,
      "idempotent": true,
      "input": {
        "type": "object",
        "properties": {
          "offset": {
            "title": "Offset",
            "description": "Start index in the list of TD documents",
            "type": "integer",
            "minimum": 0,
            "default": 0
          },
          "limit": {
            "title": "Limit",
            "description": "Maximum number of documents to return",
            "type": "integer",
            "minimum": 1,
            "default": 100
          }
        },
        "uriVariables": {
          "offset": {
            "title": "Offset",
            "type": "number",
            "hiveot:input": "offset"
          },
          "limit": {
            "title": "Max nr of responses",
            "type": "number",
            "hiveot:input": "limit"
          }
        }
      },
      "output": {
        "title": "TD list",
        "description": "List of JSON encoded TD documents",
        "type": "array",
        "items": {
          "type": "string"
        }
      },
      "forms": [
        {
          "href": "/things",
          "htv:methodName": "GET",
          "contentType": "application/td+json",
          "response": {
            "description": "Success response",
            "htv:statusCodeValue": 204
          },
          "additionalResponses": [
            {
              "description": "Invalid serialization or TD",
              "contentType": "application/problem+json",
              "htv:statusCodeValue": 400
            }
          ]
        }
      ]
    },

    "updateThing": {
      "@type": "hiveot:function",
      "title": "Update Thing TD",
      "description": "Update the Thing TD in the directory. For use by agents only.",
      "idempotent": true,
      "allow": [
        "agent",
        "admin"
      ],
      "comment": "Only agents can update their TD",
      "input": {
        "title": "TD",
        "description": "Device TD document in JSON format",
        "comment": "The spec defines type object but there is no scheme associated with it.",
        "type": "string"
      },
      "uriVariables": {
        "id": {
          "@type": "ThingID",
          "title": "Thing Description ID",
          "type": "string",
          "comment": "uri 'id' is in the spec, bit ignored as the TD contains the ID."
        }
      },
      "forms": [
        {
          "href": "/things/{id}",
          "htv:methodName": "PUT",
          "contentType": "application/td+json",
          "response": {
            "description": "Success response",
            "htv:statusCodeValue": 204
          },
          "additionalResponses": [
            {
              "description": "Invalid serialization or TD",
              "contentType": "application/problem+json",
              "htv:statusCodeValue": 400
            }
          ]
        }
      ]
    }
  },
  "links": []
}